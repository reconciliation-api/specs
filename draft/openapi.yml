openapi: 3.1.0
info:
  title: Reconciliation API - OpenAPI 3.1
  summary: OpenAPI definition of the Reconciliation API
  description: |-
    Web API letting clients match data against a database hosted by the service.

    Some useful links:
      - [ W3C Entity Reconciliation Community Group ](https://www.w3.org/community/reconciliation/)
      - [ Source code for Reconciliation API ](https://github.com/reconciliation-api/specs)
      - [ List of known public endpoints ](https://reconciliation-api.github.io/testbench/)
      - [ OpenRefine wiki list of reconciliable data sources ](https://github.com/OpenRefine/OpenRefine/wiki/Reconciliable-Data-Sources)
  contact:
    name: W3C Entity Reconciliation Community Group
    url: https://www.w3.org/community/reconciliation/
    email: public-reconciliation@w3.org
  license:
    name: W3C Community Final Specification Agreement (FSA)
    url: https://www.w3.org/community/about/process/fsa-deed/
####
# version: is the version of this document, not the version of the Reconciliation API.
#          when updating this document, please bump this version below:
####
  version: 0.0.1

externalDocs:
  description: Find out more about Reconciliation API
  url: https://reconciliation-api.github.io

# tags:
#   - name: manifest
#     description: the service manifest 
#   - name: reconciliation
#     description: |-
#       the process of linking entities or records with
#       other entities or records
#     externalDocs:
#       description: Wikidata URL for "data reconciliation"
#       url: https://www.wikidata.org/wiki/Q48719515
#   - name: entity
#     description: a record in the data source exposed by the service
#     externalDocs:
#       description: Wikidata URL for "entity"
#       url: https://www.wikidata.org/wiki/Q35120

paths:
  /:
    get:
      operationId: getManifest
      tags:
        - Service Definition
      summary: retrieve the service manifest
      responses:
        '200':
          description: Service manifest
          content:
            application/json:
              schema:
                name: service manifest
                type: object
                $ref: '#/components/schemas/manifest'
              example:
                $ref: examples/manifest/valid/getty.json
  /reconcile:
    post:
      operationId: reconciliationQueries
      tags:
        - Reconcile
      summary: submit a batch of reconciliation queries
      requestBody:
        required: true
        description: A batch of reconciliation queries
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/reconcile-query-batch'
            example:
              $ref: '#examples/reconciliation-query-batch/valid/example-full'
      responses:
        '200':
          description: Reconciliation candidates for each query
          content:
            application/json:
              schema:
                $ref: schemas/reconciliation-result-batch.json
              example:
                $ref: examples/reconciliation-result-batch/valid/example-full.json
  /suggest/entity:
    get:
      operation: suggestEntities
      tags:
        - Suggest
      summary: retrieve auto-complete suggestions for entities
      parameters:
        - name: prefix
          in: query
          required: true
          description: the search string input by the user
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          description: a number of results to skip
          schema:
            type: integer
      responses:
        '200':
          description: a list of entities suitable for displaying in a drop-down auto-complete widget
          content:
            application/json:
              schema:
                $ref: schemas/suggest-entities-response.json
              example:
                $ref: examples/suggest-entities-response/valid/example.json
  /suggest/property:
    get:
      operation: suggestProperties
      tags:
        - Suggest
      summary: Retrieve auto-complete suggestions for properties
      parameters:
        - name: prefix
          in: query
          required: true
          description: the search string input by the user
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          description: a number of results to skip
          schema:
            type: integer
      responses:
        '200':
          description: A list of properties suitable for displaying in a drop-down auto-complete widget
          content:
            application/json:
              schema:
                $ref: schemas/suggest-properties-response.json
              example:
                $ref: examples/suggest-properties-response/valid/example.json
  /suggest/type:
    get:
      operation: suggestTypes
      tags:
        - Suggest
      summary: Retrieve auto-complete suggestions for types
      parameters:
        - name: prefix
          in: query
          required: true
          description: the search string input by the user
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          description: a number of results to skip
          schema:
            type: integer
      responses:
        '200':
          description: A list of types suitable for displaying in a drop-down auto-complete widget
          content:
            application/json:
              schema:
                $ref: schemas/suggest-types-response.json
              example:
                $ref: examples/suggest-types-response/valid/example.json
  /preview:
    get:
      operation: preview
      tags:
        - Preview
      summary: Retrieve a compact representation of an entity as an HTML page
      parameters:
        - name: id
          in: query
          required: true
          description: an entity id
          schema:
            type: string
      responses:
        '200':
          description: A web page describing the entity
          content:
            text/html:
              example: "test"
  /extend:
    post:
      operation: extend
      tags:
        - Extend
      summary: Retrieve the values of properties on a list of entities
      requestBody:
        required: true
        description: A list of entities and the properties to fetch on them
        content:
          application/json:
            schema:
              $ref: schemas/data-extension-query.json
            example:
              $ref: examples/data-extension-query/valid/example-full.json
      responses:
        '200':
          description: The values of the properties on those entities
          content:
            application/json:
              schema:
                $ref: '#components/schemas/data-extension-response'
              example:
                $ref: '#examples/data-extension-response/valid/example-full'
  /extend/propose:
    get:
      operation: proposeProperties
      tags:
        - Extend
      summary: List properties commonly fetched on entities of a given type
      parameters:
        - name: type
          in: query
          required: true
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: A list of properties which could be fetched on entities of the provided type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/data-extension-property-proposal'
              example:
                $ref: '#/components/schemas/data-extension-property-proposal/valid/response'

components:
  schemas:

    identifier:
      type: string
      name: id
      description: a unique character string that identifies an entity

    entity:
      required:
        - id
        - name
      summary: |-
        An entity is a record in the data source exposed by the service.
        For each entity, expanding the template with 'id' being set to
        the entity's identifier MUST result in a valid URI.
      type: object
      properties:
        id:
          type: string
          description: |-
           an identifier for the entity.
           This identifier must be unique among all entities.
           Services for which the entity's identifier is already a full URI
           can use the '{+id} template, which disables the escaping of some characters
           when inserting the identifier in the URI template.
          allOf:
            $ref: '#/components/schemas/uri-template'
            $ref: '#/components/schemas/identifier'
        name:
          type: string
          description: a name, which is also a non-empty string
        description:
          type: string
          description: an optional description as a human-readable string
        type:
          $ref: '#/components/schemas/type'

    type:
      required:
        - id
        - name
      type: object
      properties:
        id:
          $id: "#/components/schemas/identifier"
          type: string
          description: |-
           a unique identifier for the type.
           This identifier must be unique among all types.
        name:
          type: string
          description: a human-readable name for the type which is a non-empty string
        description:
          type: string
          description: |-
            optional description which can be provided to disambiguate namesakes
            and provide more context
        broader:
          type: array
          description: |-
           an optional array of types, each representing a direct (i.e., immediate) 'broader' [skos-reference] category of [entities]: /entity
          items:
            $ref: '#/components/schemas/broader'
  
    broader:
      type: string
      externalDocs: 
        description: a skos-reference broader category
        url: https://www.w3.org/TR/skos-reference/#semantic-relations
        
    property:
      required:
        - id
        - name
      type: object
      properties:
        id:
          $id: '#/components/schemas/identifier'
          type: string
          description: |-
           an identifier, which is a non-empty string.
           This identifier must be unique among all properties
          $ref: '#/components/schemas/identifier'
        name:
          type: string
          description: a human-readable name for the property
    
    property-value:
      type: string
      name: property value
      description: a value for a property
      enum:
        - string
        - boolean
        - integer
    
    uri-template:
      type: object
      externalDocs: 
        description: a URI template as defined by RFC6570
        url: https://www.rfc-editor.org/rfc/rfc6570

    manifest:
      required:
        - versions
        - name
        - defaultTypes
      type: object
      properties:
        versions:
          type: array
          description: |-
            The array of API versions supported by the endpoint, such as ["0.1", "0.2"].
            Since this field did not exist in version 0.1, services which do not declare
            a versions field are expected to only support version 0.1.
          examples: ["0.1", "0.2"]
        name:
          type: string
          description: |-
           a human-readable name for the service,
           generally the name of the database it exposes.
           In the case where multiple reconciliation services exist for the same database,
           it is in the interest of a service to bear a meaningful name
           which will help disambiguating it from others
          examples: [myReconService]
        defaultTypes:
          type: array
          description: |-
           an array of types which are considered sensible default choices as types
           supplied in reconciliation queries. For services which do not rely on types,
           this MAY contain a single type with a generic name
           making it clear that all entities in the database are instances of this type.
          items:
            $ref: '#/components/schemas/type'
        documentation:
          type: string
          format: uri
          description: |-
           an optional URL with human-readable documentation about the service,
           for instance giving more information about the data it exposes.
        logo:
          type: string
          format: uri
          description: |-
            an optional URL of a square image which can be used as the service's logo.
        serviceVersion:
          type: string
          description: |-
           an optional string which describes the version of the software exposing this service.
           This is not to be confused with `versions`[array] property
           which is about the versions of the reconciliation API supported by the service.
        view:
          type: object
          description: |-
           an object which contains a single field url.
           Its value is a URI template for entities
          $ref: '#/components/schema/uri-template'
          properties:
            url:
              
        feature_view:
          type: object
          description: |-
            an object which contains a url field pointing to a human-readable web page
            which can be used to view matching features.
          properties:
            url:
              $ref: '/#components/schema/uri-template'
              examples: ["http://www.wikidata.org/entity/{id}"]
        suggest:
          type: object
          description: |-
            an optional object which may contain the following fields,
            depending on which suggest services are offered
          properties:
            entity:
              type: boolean
              description: |-
                a boolean indicating if the service supports auto-suggestion of [entity]: /entity "entities"
            property:
              type: boolean
              description: |-
                a boolean indicating if the service supports auto-suggestion of [property]: /property "properties"
            type:
              type: boolean
              description: |-
                a boolean indicating if the service supports auto-suggestion of [type]: /type "types"
        extend:
          type: object
          description: |-
            a data extension metadata, supplied if the service offers a data extension service
    
    data-extension-service:
      description: |-
        a service which allows clients to fetch the values of some [property]: /property "properties" on a selection of entities.
      
    data-extension-metadata:
      properties:
        propose_properties:
          type: boolean
          description: |-
            a boolean indicating if the service supports [data extension property proposal]
        property_settings:
          type: array
          description: |-
            an array of [data-extension-property-setting]: /data-extension-property-setting "data extension property settings". 
          $ref: '#/components/schemas/data-extension-property-setting'

    data-extension-property-setting:
      properties:
        name:
          type: string
          description: |-
            a name for the setting, which identifies the setting uniquely
        label:
          type: string
          description: |-
            a human-readable label, which is used when presenting the setting to the user in a form
        type:
          type: string
          description: |-
            a data type, which can be one of the strings `number, `text`, `checkbox`, or `select`.
            This determines which type of value the property setting is expected to store.
            Clients SHOULD render this setting with the corresponding HTML element
        default:
          type: string
          description: |-
            a default value for the setting, when not provided or left untouched by the user
        help_text:
          type: string
          description: |-
            a help text, which describes the meaning of the field to the user.
            This is meant to be a short string that can be displayed alongside the corresponding form field
        choices:
          type: array
          description: |-
            If type is `select`, an array of property setting choices.
          items:
            $ref: '#/components/schemas/property-settings'
            
    condition:
      type: object
      description: some conditional object
      properties:
        match_type:
          description: |-
            either `name` or `property`, depending on whether the condition relates to
            entity names or their properties.
        pid:
          description: |-
            a [property]: /property identifier, to be provided if and only if the match_type is property.

        v:
          description: |-
            one or more [property-value]: /property-value "property values". If `match_type` is `name`, then this value is to be matched to entity names, otherwise to the property values via the supplied [pid]. The specifics of how this similarity is defined are determined by the service.
        
        required:
          description: |-
            an optional boolean indicating if a match for the property is required for an
            entity to enter the list of candidates (i.e. acting like a filter or a WHERE
            clause in SQL) or optional (i.e. only effecting the entity's rank in the
            list of candidates)
        
        match_quantifier:
          description: |-
            An optional string to indicate which of the values in v to match.
            MUST be any (equivalent to boolean OR), all (equivalent to boolean AND),
            or none (equivalent to boolean NOT)
        
        match_qualifier:
          description: |-
            An optional string to indicate how to match the values in v.
            This can be used for general matching relations like "skos:exactMatch",
            "skos:closeMatch", etc. or for specific features like spatial matching
            with geo data (e.g. containment search with "schema:containsPlace" etc.) or
            custom matching on date fields (e.g. services supporting the [EDTF](https://www.loc.gov/standards/datetime/) specification
            could use "EDTF:Level-0" etc.)
            To allow discovery of supported qualifiers by clients, services that support
            match_qualifier MUST return the supported match_qualifiers for each property
            in their property suggest responses
        
    reconcile-query:
      required:
        - conditions
      type: object
      description: a single query
      properties:
        conditions:
          type: array
          description:
            an array of conditions (at least one)
          items:
            oneOf:
              $ref: '#/components/schemas/condition'
        type:
          description: |-
            an optional type identifier. Supplying such a type allows users to restrict
            the search to entities which bear this type. Whether this restriction should be
            a hard constraint or simply induce a change on the reconciliation scores
            can be determined by the service.
            In particular, services MAY return candidates which do not belong to
            the supplied type.
        
        limit:
          description: |-
            An optional limit on the number of candidates to return,
            which must be a positive integer
        
    reconcile-query-batch:
      required:
        - queries
      type: object
      description: |-
        This schema validates the JSON serialization of any reconciliation query batch,
        i.e. the payload of a POST to a reconciliation endpoint.
      properties:
        queries:
          type: array
          xml:
          name: queries
          wrapped: true
          description: a list of queries to be processed by the service
          items:
            $ref: '#/components/schemas/reconcile-query'
      
    reconciliation-result-batch:
